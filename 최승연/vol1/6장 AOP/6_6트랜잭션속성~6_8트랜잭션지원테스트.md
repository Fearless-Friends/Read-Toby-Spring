# 범위
6장 AOP

6.6 트랜잭션 속성  
6.7 애노테이션 트랜잭션 속성과 포인트 컷  
6.8 트랜잭션 지원 테스트

# WHY
복잡한 트랜잭션 속성이 요구될 때, 어떻게 간편하게 적용할 수 있을까?

# WHAT
세밀한 트랜잭션 속성의 제어를 위해 직접 타깃에 트랜잭션 속성정보를 셋팅하는 방법은 없을까?

- 메소드 이름 패턴을 이용해서 일괄적으로 트랜잭션 속성을 부여하는 방식은 안됨!
  - 기본 속성과 다른 겨우가 있을 떄 마다 일일이 포인트컷과 어드바이스를 새로 추가해줘야 함(번거로움)

# HOW
스프링은 `@Transactional` 어노테이션을 제공한다.

## 동작방식
어노테이션이 부여된 모든 오브젝트(클래스, 메서드)를 자동으로 타깃 오브젝트로 인식한다.
이떄, 구체적일수록 우선순위가 높다.
ex. 인터페이스에 적용된 어노테이션 속성 < 메서드에 적용된 어노테이션 속성


# ETC
## 트랜잭션
### 기본 개념
더 이상 쪼갤 수 없는 최소 단위의 작업  
대원칙: 트랜잭션 경계 안에서 진행된 작업은 commit() 을 통해 모두 성공 or rollback()을 통해 모두 취소되어야 함

### 트랜잭션 동작을 제어하는 4가지 속성
#### 전파옵션
`getTransaction()` 이란 로직이 있는 이유 (== 항상 트랜잭션이 새로 시작되는 것이 아님)

- PROPAGATION_REQUIRED: 진행중인 트랜잭션이 없으면 새로 시작, 있으면 참여
- PROPAGATION_REQUIRES_NEW: 항상 새로운 트랜잭션 만들어서 시작
- PROPAGATION_NOT_SUPPORTED: 트랜잭션 없이 동작
  - 왜 필요할까?
    - 포인트컷으로 트랜잭션 대상 설정을 할 때, 하나하나 할 수 없으므로 일단 다 적용시키고, 그 안에서 세부적으로 조절하려는 목적(혹시 필요 없을 수도 있으니까) 
#### 격리수준
default: `ISOLATION_DEFAULT`

#### 제한시간
트랜잭션을 수행하는 제한시간

#### 읽기전용
true일 경우 -> 트랜잭션 내에서 데이터 cud 시도를 막아줌(예외 발생)

## 테스트
### 롤백테스트
테스트 동작과정에서 서로 의존하지 안됨.
== 테스트가 진행되는 순서나 앞의 테스트의 성공여부에 따라서 다음 테스트의 결과가 달라지면 안됨
-> 이것을 보장해주기 위해 테스트클래스에서 `@Transactional` 을 쓰면 롤백해줌(설정으로 안할 수도 있음)