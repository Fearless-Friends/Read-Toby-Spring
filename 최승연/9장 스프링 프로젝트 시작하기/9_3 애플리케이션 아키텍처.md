# 범위
9.3 애플리케이션 아키텍처

# 요약
스프링 애플리케이션은 역할에 따라 3계층으로 구분되고, 다시 기수르이 추상도에 따라 세분화되는 계층형 아키텍처를 사용하는 것이 좋다.  
아키텍처는 애플리케이션이 다루는 정보의 관점에서 데이터 중심과 오브젝트 중심으로 구분할 수 있다.  
스프링에 가장 잘 어울리는 아키텍처는 오브젝트 중심의 아키텍처이다. 

# 아키텍처란?
어떤 경계 안에 있는 내부 구성요소들이 어떤 책임을 갖고 있고, 어떤 방식으로 서로 관계를 맺고 동작하는지를 규정하는 것
- 단순히 정적인 구조를 나타내는 것 X
- 그 구조에서 일어나는 동적인 행위와 깊은 관련 있음 O

# 9.3.1 계층형 아키텍처
관심, 책임, 성격, `변하는 이유와 방식`이 서로 다른 것들을 분리  

**장점**  
분리한 각 요소들의 `응집도는 높여주고`, `결합도는 낮춰줌` == 각 계층은 자신의 역할만 충실해야 함

**형태**  
<img alt="img.png" src="그림9-13 3계층 아키텍처.png" width="500"/>

**주의사항**
어떤 경우에라도 계층 사이의 낮은 결합도를 깨뜨리지 않도록 설계해야 함.
- 계층 사이으이 호출은 인터페이스를 통해 이뤄져야 함 
- 중간 계층을 건너뛰어서 있는 빈을 DI하지 말아야 함. 

## 데이터 액세스 계층(DAO 계층)
DB/ 타 프로그램에 접근하는 역할

## 서비스 계층
DAO 계층을 호출하고, 이를 활용해서 비즈니스 로직 작성
서비스 계층의 클래스는 POJO로 작성됨. 

## 프레젠테이션 계층
클라이언트와 연결되는 계층
- 클라이언트 종류에 상관없이, HTTP 프로토콜을 사용하는 서블릿이 바탕이 됨

# 9.3.2 애플리케이션 정보 아키텍처
애플리케이션을 사이에 두고 흘러다니는 정보를 어떤 식으로 다룰까?
- 엔터프라이즈 시스템은 본질적으로 동시에/많은 작업이 빠르게 수행되야 함.
- 사용자의 요청을 처리하는 동안만 간단한 상태를 유지함

## 데이터 중심 아키텍처
정보를 단순히 값 or 값을 담기 위한 목적의 오브젝트 형태로 취급하는 구조

**종류**  
핵심 비즈니스 로직을 어디에 많이 두는지에 따라서, 2가지로 구분 가능
- DB에 무게두는 구조 -> DB/SQL 중심의 로직 구현 방식
- 서비스 계층의 코드에 무게를 두는 구조 -> 거대한 서비스 계층 방식
  - 코드 중복이 많이 발생할 수 있음 

**단점**  
계층 사이의 결합도가 높고, 응집도는 떨어진다.

## 오브젝트 중심 아키텍처 (9.3.3)
오브젝트를 만들어 두고, 오브젝트 구조 안에 정보를 담아서 각 계층 사이에 전달하게 반드는 것
- 도메인 모델을 반영하는 오브젝트 구조를 만들어서, 그걸 각 계층 사이에서 정보를 전송하는 데 사용함
- 대체로 관계형 DB의 엔티티 구조와 유사함. 

**데이터 중심 아키텍처와 차이점**
1. DB에서 SQL 결과로 가져온 값을 그대로 사용하지 않음. 도메인 모델은 여러 테이블의 프로퍼티들이 결합된 형태일 수 있음

**단점**
최적화된 SQL을 매번 만들어 사용하는 경우에 비해, 성능 면에서 손해임
- DAO는 비즈니스 로직의 사용방식을 알지 못한채, 동작하기 때문에
- 해결법) ORM 쓰기(lazyLoading 자동적용됨), 그게 안되면 lazyLoading 기법 적용 

**종류**
도메인 오브젝트를 어떻게 활용하는지에 따라 나뉨  
클래스는 속성+행위 조합임을 고려!

- 속성만 있음 -> 빈약한 도메인 오브젝트 방식
- 속성+행위 둘다 있음 -> 풍부한 도메인 오브젝트 방식

### 빈약한 도메인 오브젝트 방식(흔히 쓰이는 방식)
<img alt="img.png" src="그림9-20 빈약한 도메인 오브젝트 방식.png" width="500"/>

도메인 오브젝트에는 오직 정보만 담겨 있고, 정보를 활용하는 아무런 기능도 갖고 있지 않음.
- 비즈니스 로직은 서비스 계층에 존재함.
- 거대 서비스 계층 방식과 유사함

### 풍부한/영리한 도메인 오브젝트 방식(DDD)

<img alt="img.png" src="그림9-21 풍성한 도메인 오브젝트 방식.png" width="500"/>

도메인 오브젝트 안에 비즈니스 로직을 담아둠 -> 스프링 빈으로 등록할 수 없음. DI될 수도, 받을 수도 없음  
서비스 계층에서는, 여러 종류의 도메인 오브젝트의 기능을 조합해서 복잡한 비즈니스 로직을 처리하는 로직 작성

**비즈니스 로직을 포함한 도메인 오브젝트를 스프링 빈으로 등록할 수 없는 이유**
사용자 별 요청에 대해 독립적인 상태를 유지하기 위해, 애플리케이션 코드에서 필요할 때 마다 새롭게 만들어서 사용하기 때문에!

**도메인 계층 방식**  
<img alt="img.png" src="그림9-22 도메인 계층 방식.png" width="500"/>

1) DI는 어떻게 받을까?  
- 도메인 오브젝트에 담을 수 있는 비즈니스 로직은, DAO계층에서 가져온 내부 데이터를 분석하거나 조건에 따라 오브젝트 정보를 변경/생성하는 역할을 해야한다.
- 그러면 스프링 빈을 DI 받을 수 있어야 한다!
- sol) 스프링 컨테이너에서 도메인 오브젝트에 DI할 빈을 찾아서 주입해주는 부가기능을 가진 AOP 적용! <<이게 정석적인 방법인가? 궁금!  

2) 도메인 오브젝트가 도메인 계층을 벗어날 땐, 어떤 형태로 전달되어야할까?  
- DTO 객체를 별도로 생성해서 이용하기!

# 9.3.4 스프링 애플리케이션을 위한 아키텍처 설계
## 상태 관리와 빈 스코프
서버의 자원이 특정 사용자에게 일정하게 할당되지 않는다.  
그래서 서버 기반의 애플리케이션은 원래 지속적으로 유지되는 상태를 갖지 않는다는 특정이 있다.
스프링도 기본적으로 stateless한 빈과 오브젝트를 사용하는 것을 권장한다. 

## 스프링이 지원하는 기술의 의미
1. 해당 기술을 스프링의 DI패턴을 따라 사용할 수 있다
2. 스프링의 서비스 추상화가 적용됐다
3. 스프링이 지지하는 프로그래밍 모델을 적용했다
4. 템플릿/콜백이 지원된다